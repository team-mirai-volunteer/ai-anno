# 2024年AI音声アシスタント（あんのうんさー）システム改善提案

## 概要
昨年の運用経験を踏まえ、以下の主要な改善点を特定しました。これらの課題に対処することで、より効率的で持続可能なシステムを構築できると考えています。

## 1. OpenRouter対応

### 課題
- political campaignでOpenAI APIを使用することがusage policy的に微妙
- より柔軟なLLMプロバイダー選択が必要

### 解決案
- OpenRouterに対応
- Gemini（または他の高性能で利用可能なモデル）を使用可能にする

## 2. 音声合成のコスト削減

### 課題
- 昨年は選挙期間で数十万程度のコストが発生
- 現在のコスト構造では持続可能性に課題

### 解決アプローチ

#### 2.1 別の音声合成エンジンの採用
- 昨年はStyle Bert Vits2を検討したが、政治利用がNGのためElevenLabsを採用
- ライセンスに問題のないOSSモデルをベースに自前運用
- ElevenLabs以外のAPIサービスの利用検討
- **今年はOSSモデルで実装したい**
- **Zonos TTSをベースラインとして検討**

#### 2.2 音声合成結果のキャッシュ実装
- 昨年は毎回音声合成を実行していた
- 使い回せる場合は再利用することで、コストとパフォーマンスの両面で大幅改善が期待できる
- 効果は返答ロジックにも依存するため、詳細な効果測定が必要

## 3. 音声合成パイプラインの簡素化

### 現在の課題
- 既存パイプライン：Azure Text to Speech → ElevenLabsでスタイル変換
- ElevenLabsのTTSは日本語の発音が不自然
- 複雑な2段階構成

### 改善目標
- 1つのエンジンで完結させる
- 前述のコスト問題と合わせて、音声合成エンジンの選定は重要度の高いイシュー

## 4. 返答生成パイプラインの見直し

### 検討事項

#### 4.1 RAGアプローチの再評価
- 昨年はRAGベースで返答生成
- 最新の高性能LLMの登場により、RAG以外のアプローチも検討可能

#### 4.2 コンテキスト評価方法の改善
- embeddingではなくLLMでコンテキスト評価を行う案
- 性能向上が期待できるが、コスト試算とrate limit考慮が必要
- 運用面での実現可能性要検討

#### 4.3 プロンプトキャッシュの活用
- マニフェスト程度の内容であればプロンプトキャッシュで対応可能

### 背景
この1年でLLMが著しく進歩しており、「返答性能の改善」というトピックで多くの改善機会が存在

## 5. インフラの改善

### 現在の構成（昨年運用時点）
- Unity on デスクトップPC + python server on Azure VM
- VM上にDBを構築
- [システム構成詳細](https://github.com/team-mirai-volunteer/ai-anno/blob/main/docs/system-architecture.md)（リンク要確認）

### 課題
- スケーラビリティに乏しい
- 可用性・保守性に課題

### 改善案

#### 5.1 マネージドサービスの活用
- チームみらいではAzure/GCPが利用可能
- どちらかのマネージドサービスに統一
- UnityもクラウドでホストするならWindowsが使えるAzureが有力（実現可能性要調査）

#### 5.2 Webアプリ化の検討
- デスクトップアプリからWebアプリへの移行検討
- [aituber-kit](https://github.com/tegnike/aituber-kit)を参考
- aituber-kit v2はライセンスが複雑なため、v1からforkすることも検討

## 優先度
1. **高**: 音声合成エンジンの選定（コスト・パイプライン簡素化）
2. **高**: OpenRouter対応（usage policy対応）
3. **中**: 音声合成キャッシュ実装
4. **中**: 返答生成パイプライン改善
5. **低**: インフラ全面改善・Webアプリ化

## 次のステップ
各項目について詳細な技術調査と実装計画の策定が必要です。特に音声合成エンジンの選定については、ライセンス確認、性能評価、コスト試算を早急に実施することを提案します。

## 実装計画案

### フェーズ1: 基盤改善（優先度：高）
- [ ] OpenRouter統合の実装
- [ ] 音声合成エンジンの調査・選定
- [ ] 音声合成キャッシュシステムの設計・実装

### フェーズ2: パフォーマンス改善（優先度：中）
- [ ] 返答生成パイプラインの最適化
- [ ] LLMベースのコンテキスト評価システム実装
- [ ] プロンプトキャッシュの導入

### フェーズ3: インフラ改善（優先度：低）
- [ ] マネージドサービスへの移行計画策定
- [ ] Webアプリ化の技術検証
- [ ] スケーラビリティ改善の実装

## 関連リソース
- [元のリポジトリ](https://github.com/takahiroanno2024/anno-ai-avatar)
- [aituber-kit](https://github.com/tegnike/aituber-kit)
- [Zonos TTS](https://github.com/yl4579/StyleTTS2)（参考）
