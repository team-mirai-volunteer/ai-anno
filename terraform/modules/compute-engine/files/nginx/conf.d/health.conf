# Health check endpoints for load balancer integration
# Based on Kubernetes standard naming conventions

# Liveness probe - Simple check if nginx process is alive
location = /healthz {
    access_log off;
    return 200 "ok\n";
    add_header Content-Type text/plain;
}

# Readiness probe - Check if application is ready to serve traffic
# This checks the API service health to ensure the full application stack is ready
location = /readyz {
    access_log off;
    proxy_pass http://api:5001/health;
    proxy_connect_timeout 5s;
    proxy_read_timeout 5s;
    proxy_send_timeout 5s;
    proxy_next_upstream off;
    
    # Add CORS headers for monitoring tools
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, OPTIONS";
    add_header Access-Control-Allow-Headers "Accept, Content-Type";
}

# Legacy health check endpoint for backward compatibility
location = /health {
    access_log off;
    return 200 "healthy\n";
    add_header Content-Type text/plain;
}